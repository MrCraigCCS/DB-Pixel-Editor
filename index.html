<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Pixel Editor</title>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            overflow: hidden;
            padding-top: 100px;
            touch-action: none; /* Disable all touch gestures */
            -webkit-touch-callout: none; /* Disable callout on iOS */
            -webkit-user-select: none; /* Disable text selection */
            user-select: none;
        }

        .container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            padding: 10px;
            max-width: 100vw;
            max-height: 100vh;
        }

        .color-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .toolbox {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 120px;
        }

        .tool-button {
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            background: #f8f9fa;
            cursor: pointer;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            transition: all 0.2s;
            user-select: none;
        }

        .tool-button:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tool-button.active {
            background: #4CAF50;
            color: white;
            border-color: #45a049;
        }

        .canvas-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .pixel-canvas {
            display: grid;
            grid-template-columns: repeat(20, 20px);
            grid-template-rows: repeat(20, 20px);
            gap: 1px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            touch-action: none; /* Disable touch gestures on canvas */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .pixel {
            width: 20px;
            height: 20px;
            background: white;
            border: 1px solid rgba(0,0,0,0.1);
            cursor: crosshair;
            transition: all 0.1s;
        }

        .pixel:hover {
            transform: scale(1.1);
            z-index: 1;
            position: relative;
        }

        .pixel.preview {
            opacity: 0.6;
            transform: scale(1.05);
            z-index: 2;
            position: relative;
        }

        .color-palette {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            min-width: 200px;
            width: 160px;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid #ddd;
            transition: all 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .color-swatch.active {
            border-color: #333;
            transform: scale(1.15);
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .advanced-controls {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #4CAF50;
        }

        .advanced-controls.active {
            display: block;
        }

        .advanced-label {
            font-size: 12px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 8px;
            text-align: center;
        }

        .color-picker-input {
            width: 100%;
            height: 60px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .confirm-color-button {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .confirm-color-button:hover {
            background: #45a049;
        }

        .brush-size-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .brush-size-slider {
            width: 100%;
        }

        .brush-size-display {
            text-align: center;
            font-size: 12px;
            color: #666;
        }

        .canvas-resize-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .size-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .size-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
        }

        .resize-button {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .resize-button:hover {
            background: #45a049;
        }

        .advanced-mode-indicator {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            color: #4CAF50;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            display: none;
        }

        .advanced-mode-indicator.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="title">üé® Mr. Craig's Pixel Editor</div>
    <div class="advanced-mode-indicator" id="advancedIndicator">üîß ADVANCED MODE ACTIVATED</div>
    
    <div class="container">
        <!-- Toolbox -->
        <div class="toolbox">
            <div class="tool-button active" data-tool="draw">
                ‚úèÔ∏è<br>Draw
            </div>
            <div class="tool-button" data-tool="erase">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSXLmIAwiWURCEDRf95TpP3PH3psRlzxQN9JQ&s" alt="Pink eraser" style="width: 24px; height: 24px;" onerror="this.src=''; this.alt='Eraser icon failed to load'; this.style.display='none';"><br>Erase
            </div>
            <div class="tool-button" data-tool="fill">
                ü™£<br>Fill
            </div>
            <div class="tool-button" data-tool="clear">
                üóëÔ∏è<br>Clear
            </div>
            
            <!-- Advanced Brush Size Controls -->
            <div class="advanced-controls" id="brushControls">
                <div class="advanced-label">Brush Size</div>
                <div class="brush-size-container">
                    <input type="range" class="brush-size-slider" id="brushSize" min="1" max="5" value="1">
                    <div class="brush-size-display" id="brushSizeDisplay">Size: 1x1</div>
                </div>
            </div>
            

        </div>

        <!-- Canvas -->
        <div class="canvas-container">
            <div class="pixel-canvas" id="canvas"></div>
            
            <!-- Advanced Canvas Resize Controls -->
            <div class="advanced-controls" id="canvasControls">
                <div class="advanced-label">Canvas Size</div>
                <div class="canvas-resize-container">
                    <div class="size-inputs">
                        <input type="number" class="size-input" id="canvasWidth" value="20" min="5" max="50">
                        <span>√ó</span>
                        <input type="number" class="size-input" id="canvasHeight" value="20" min="5" max="50">
                    </div>
                    <button class="resize-button" id="resizeCanvas">Resize Canvas</button>
                </div>
            </div>
        </div>

        <!-- Color Section -->
        <div class="color-section">
            <!-- Color Palette -->
            <div class="color-palette" id="palette">
            </div>
            
            <!-- Advanced Color Picker -->
            <div class="advanced-controls" id="colorControls" style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 2px dashed #4CAF50;">
                <div class="advanced-label">Custom Color</div>
                <input type="color" class="color-picker-input" id="customColorPicker" value="#FF0000">
                <button class="confirm-color-button" id="confirmColor">Use This Color</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize variables
        let currentTool = 'draw';
        let currentColor = '#FF0000';
        let isDrawing = false;
        let advancedMode = false;
        let brushSize = 1;
        let canvasWidth = 20;
        let canvasHeight = 20;
        let keysPressed = new Set();

        // Color palette - 44 colors organized by hue and shade
        const colors = [
            // Reds
            '#FF0000', '#FF6B6B', '#DC143C', '#8B0000',
            // Oranges
            '#FFA500', '#FF8C00', '#FF4500', '#D2691E',
            // Yellows
            '#FFFF00', '#FFD700', '#FFFF99', '#DAA520',
            // Greens
            '#00FF00', '#32CD32', '#228B22', '#006400',
            // Blues
            '#0000FF', '#4169E1', '#1E90FF', '#000080',
            // Purples
            '#800080', '#9932CC', '#8A2BE2', '#4B0082',
            // Pinks
            '#FF69B4', '#FFB6C1', '#FF1493', '#C71585',
            // Neutrals
            '#000000', '#808080', '#C0C0C0', '#FFFFFF',
            // Light Reds & Corals
            '#FFB3BA', '#FF7F7F', '#CD5C5C', '#A0522D',
            // Peach & Light Orange
            '#FFDFBA', '#FFDAB9', '#F4A460', '#CD853F',
            // Light Yellows & Cream
            '#FFFFBA', '#F0E68C', '#BDB76B', '#9ACD32'
        ];

        // Create canvas pixels
        function createCanvas() {
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = ''; // Clear existing pixels
            canvas.style.gridTemplateColumns = `repeat(${canvasWidth}, 20px)`;
            canvas.style.gridTemplateRows = `repeat(${canvasHeight}, 20px)`;
            
            for (let i = 0; i < canvasWidth * canvasHeight; i++) {
                const pixel = document.createElement('div');
                pixel.className = 'pixel';
                pixel.dataset.index = i;
                canvas.appendChild(pixel);
            }
        }

        // Create color palette
        function createPalette() {
            const palette = document.getElementById('palette');
            colors.forEach((color, index) => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.dataset.color = color;
                if (index === 0) swatch.classList.add('active');
                palette.appendChild(swatch);
            });
        }

        // Flood fill algorithm
        function floodFill(startIndex, targetColor, fillColor) {
            // Convert colors to consistent format for comparison
            const normalizedTarget = normalizeColor(targetColor);
            const normalizedFill = normalizeColor(fillColor);
            
            if (normalizedTarget === normalizedFill) return;
            
            const pixels = document.querySelectorAll('.pixel');
            const visited = new Set();
            const stack = [startIndex];
            
            while (stack.length > 0) {
                const index = stack.pop();
                if (visited.has(index) || index < 0 || index >= pixels.length) continue;
                
                const pixel = pixels[index];
                const currentPixelColor = pixel.style.backgroundColor || 'white';
                const normalizedCurrent = normalizeColor(currentPixelColor);
                
                if (normalizedCurrent !== normalizedTarget) continue;
                
                visited.add(index);
                pixel.style.backgroundColor = fillColor;
                pixel.dataset.originalColor = fillColor;
                
                // Add adjacent pixels
                const row = Math.floor(index / canvasWidth);
                const col = index % canvasWidth;
                
                // Up
                if (row > 0) stack.push(index - canvasWidth);
                // Down
                if (row < canvasHeight - 1) stack.push(index + canvasWidth);
                // Left
                if (col > 0) stack.push(index - 1);
                // Right
                if (col < canvasWidth - 1) stack.push(index + 1);
            }
        }

        // Normalize color values for consistent comparison
        function normalizeColor(color) {
            if (!color || color === 'white' || color === '') return 'white';
            if (color.startsWith('#')) return hexToRgb(color);
            return color;
        }

        // Convert hex to rgb for comparison
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgb(${r}, ${g}, ${b})`;
        }

        // Handle pixel interactions
        function handlePixelClick(e) {
            const pixel = e.target;
            const index = parseInt(pixel.dataset.index);
            
            if (currentTool === 'draw') {
                drawWithBrush(index, currentColor);
            } else if (currentTool === 'erase') {
                drawWithBrush(index, 'white');
            } else if (currentTool === 'fill') {
                const targetColor = pixel.style.backgroundColor || 'white';
                floodFill(index, targetColor, currentColor);
            }
        }

        // Draw with brush size
        function drawWithBrush(centerIndex, color) {
            const pixels = document.querySelectorAll('.pixel');
            const centerRow = Math.floor(centerIndex / canvasWidth);
            const centerCol = centerIndex % canvasWidth;
            
            const radius = Math.floor(brushSize / 2);
            
            for (let row = centerRow - radius; row <= centerRow + radius; row++) {
                for (let col = centerCol - radius; col <= centerCol + radius; col++) {
                    if (row >= 0 && row < canvasHeight && col >= 0 && col < canvasWidth) {
                        const pixelIndex = row * canvasWidth + col;
                        if (pixels[pixelIndex]) {
                            pixels[pixelIndex].classList.remove('preview');
                            pixels[pixelIndex].style.backgroundColor = color;
                            pixels[pixelIndex].dataset.originalColor = color;
                        }
                    }
                }
            }
        }

        function handlePixelMouseOver(e) {
            if (isDrawing && currentTool === 'draw') {
                const index = parseInt(e.target.dataset.index);
                drawWithBrush(index, currentColor);
            } else if (isDrawing && currentTool === 'erase') {
                const index = parseInt(e.target.dataset.index);
                drawWithBrush(index, 'white');
            } else if (!isDrawing) {
                // Show preview
                const index = parseInt(e.target.dataset.index);
                showPreview(index);
            }
        }

        // Show preview of what will be drawn
        function showPreview(centerIndex) {
            clearPreview();
            
            if (currentTool === 'fill') {
                // No preview for fill tool
                return;
            }
            
            // For draw and erase tools, show brush area
            const pixels = document.querySelectorAll('.pixel');
            const centerRow = Math.floor(centerIndex / canvasWidth);
            const centerCol = centerIndex % canvasWidth;
            
            const radius = Math.floor(brushSize / 2);
            const previewColor = currentTool === 'erase' ? 'white' : currentColor;
            
            for (let row = centerRow - radius; row <= centerRow + radius; row++) {
                for (let col = centerCol - radius; col <= centerCol + radius; col++) {
                    if (row >= 0 && row < canvasHeight && col >= 0 && col < canvasWidth) {
                        const pixelIndex = row * canvasWidth + col;
                        if (pixels[pixelIndex]) {
                            pixels[pixelIndex].classList.add('preview');
                            pixels[pixelIndex].style.backgroundColor = previewColor;
                        }
                    }
                }
            }
        }

        // Clear preview effects
        function clearPreview() {
            document.querySelectorAll('.pixel.preview').forEach(pixel => {
                pixel.classList.remove('preview');
                // Restore original color or white if no color was set
                const originalColor = pixel.dataset.originalColor || 'white';
                pixel.style.backgroundColor = originalColor;
            });
        }

        // Store original colors when pixels are painted
        function storeOriginalColor(pixel) {
            if (!pixel.dataset.originalColor) {
                pixel.dataset.originalColor = pixel.style.backgroundColor || 'white';
            }
        }

        // Toggle advanced mode
        function toggleAdvancedMode() {
            advancedMode = !advancedMode;
            const indicator = document.getElementById('advancedIndicator');
            const brushControls = document.getElementById('brushControls');
            const canvasControls = document.getElementById('canvasControls');
            const colorControls = document.getElementById('colorControls');
            
            if (advancedMode) {
                indicator.classList.add('active');
                brushControls.classList.add('active');
                canvasControls.classList.add('active');
                colorControls.classList.add('active');
            } else {
                indicator.classList.remove('active');
                brushControls.classList.remove('active');
                canvasControls.classList.remove('active');
                colorControls.classList.remove('active');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            createCanvas();
            createPalette();
            
            // Tool selection
            document.querySelectorAll('.tool-button').forEach(button => {
                button.addEventListener('click', function() {
                    if (this.dataset.tool === 'clear') {
                        // Clear all pixels
                        document.querySelectorAll('.pixel').forEach(pixel => {
                            pixel.style.backgroundColor = 'white';
                        });
                        return;
                    }
                    
                    document.querySelectorAll('.tool-button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTool = this.dataset.tool;
                });
            });
            
            // Color selection
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.addEventListener('click', function() {
                    document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                    this.classList.add('active');
                    currentColor = this.dataset.color;
                });
            });
            
            // Canvas interactions - Mouse events
            document.getElementById('canvas').addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('pixel')) {
                    isDrawing = true;
                    handlePixelClick(e);
                }
            });
            
            document.getElementById('canvas').addEventListener('mouseover', function(e) {
                if (e.target.classList.contains('pixel')) {
                    handlePixelMouseOver(e);
                }
            });

            document.getElementById('canvas').addEventListener('mouseleave', function() {
                clearPreview();
            });
            
            document.addEventListener('mouseup', function() {
                isDrawing = false;
            });

            // Touch events for mobile/tablet support
            document.getElementById('canvas').addEventListener('touchstart', function(e) {
                e.preventDefault(); // Prevent scrolling and other touch behaviors
                const touch = e.touches[0];
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
                if (element && element.classList.contains('pixel')) {
                    isDrawing = true;
                    handlePixelClick({target: element});
                }
            }, {passive: false});
            
            document.getElementById('canvas').addEventListener('touchmove', function(e) {
                e.preventDefault(); // Prevent scrolling and swipe gestures
                if (isDrawing) {
                    const touch = e.touches[0];
                    const element = document.elementFromPoint(touch.clientX, touch.clientY);
                    if (element && element.classList.contains('pixel')) {
                        handlePixelMouseOver({target: element});
                    }
                }
            }, {passive: false});
            
            document.getElementById('canvas').addEventListener('touchend', function(e) {
                e.preventDefault();
                isDrawing = false;
                clearPreview();
            }, {passive: false});

            // Prevent touch scrolling on the entire canvas container
            document.querySelector('.canvas-container').addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, {passive: false});

            // Prevent swipe-to-go-back on the entire body
            document.body.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault(); // Prevent multi-touch gestures
                }
            }, {passive: false});

            document.body.addEventListener('touchmove', function(e) {
                // Only prevent if touch started near the left edge (swipe back gesture)
                const touch = e.touches[0];
                if (touch.clientX < 50) {
                    e.preventDefault();
                }
            }, {passive: false});
            
            // Prevent context menu on right click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });

            // Keyboard event listeners for secret combination
            document.addEventListener('keydown', function(e) {
                keysPressed.add(e.key.toLowerCase());
                
                // Check for Shift + D + B combination
                if (keysPressed.has('shift') && keysPressed.has('d') && keysPressed.has('b')) {
                    toggleAdvancedMode();
                    keysPressed.clear(); // Clear to prevent repeated activation
                }
            });

            document.addEventListener('keyup', function(e) {
                keysPressed.delete(e.key.toLowerCase());
            });

            // Advanced controls event listeners
            document.getElementById('brushSize').addEventListener('input', function(e) {
                brushSize = parseInt(e.target.value);
                document.getElementById('brushSizeDisplay').textContent = `Size: ${brushSize}x${brushSize}`;
                // Update preview if mouse is over canvas
                const hoveredPixel = document.querySelector('.pixel:hover');
                if (hoveredPixel) {
                    const index = parseInt(hoveredPixel.dataset.index);
                    showPreview(index);
                }
            });

            document.getElementById('confirmColor').addEventListener('click', function() {
                const pickerColor = document.getElementById('customColorPicker').value;
                currentColor = pickerColor;
                // Remove active class from palette swatches
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            });

            document.getElementById('resizeCanvas').addEventListener('click', function() {
                const newWidth = parseInt(document.getElementById('canvasWidth').value);
                const newHeight = parseInt(document.getElementById('canvasHeight').value);
                
                if (newWidth >= 5 && newWidth <= 50 && newHeight >= 5 && newHeight <= 50) {
                    canvasWidth = newWidth;
                    canvasHeight = newHeight;
                    createCanvas();
                    
                    // Re-attach canvas event listeners
                    document.getElementById('canvas').addEventListener('mousedown', function(e) {
                        if (e.target.classList.contains('pixel')) {
                            isDrawing = true;
                            handlePixelClick(e);
                        }
                    });
                    
                    document.getElementById('canvas').addEventListener('mouseover', function(e) {
                        if (e.target.classList.contains('pixel')) {
                            handlePixelMouseOver(e);
                        }
                    });
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987689e5848e6817',t:'MTc1OTI2NDg2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
